import{a as d,q as l,L as s,C as o}from"./index-3559784b.js";const t=d(),h=l("klient",{state:()=>({lvData:[],dvData:{},dvKommunikacii:{},activeTab:"main",showBaseModal:!1,showKommunikaciiModal:!1,pageCount:0,itemsCount:0,searchAndSort:{sortName:"id",sortOrder:"down",isArchive:!1},klientListAll:[]}),getters:{tableHeader:e=>[{label:"ФИО",name:"fio",orederName:"fio",type:"char",width:"100px"},{label:"Телефон",name:"phone",orederName:"phone",type:"char",width:"100px"},{label:"Адреса",name:"addressCache",orederName:"address_cache",type:"char",width:"100px"},{label:"Email",name:"email",orederName:"email",type:"char",width:"60px"},{label:"Дата последнего заказа",name:"dataPoslednegoZakazaDisplay",orederName:"data_poslednego_zakaza",type:"char",width:"70px"},{label:"Постится",name:"postnoe",orederName:"postnoe",type:"bool",width:"70px"},{label:"Примечание",name:"primechanie",orederName:"primechanie",type:"char",width:"120px"},{label:"Исключение",name:"alergiaCache",orederName:"alergia_cache",type:"char",width:"100px"}],searchList:e=>[{type:"text",label:"ФИО",model:"fio"},{type:"text",label:"Телефон",model:"phone"},{type:"text",label:"Адрес",model:"address_cache"},{type:"select",label:"Поститься",model:"postnoe",items:t.yesNoNullList,itemTitle:"name",itemVaile:"id"},{type:"text",label:"Исключение",model:"alergia_cache"},{type:"select",label:"Архивность",model:"isArchive",items:t.yesNoList,itemTitle:"name",itemVaile:"id"}],baseModalTitle:e=>{var a,i;return(a=e.dvData)!=null&&a.nazvanie?(i=e.dvData)==null?void 0:i.nazvanie:"Новый клиент"},kommunikaciiModalTitle:e=>{var a,i,r;return(a=e.dvKommunikacii)!=null&&a.id?((i=e.dvKommunikacii)==null?void 0:i.kanalSvyazi)+" - "+((r=e.dvKommunikacii)==null?void 0:r.dateLabel):"Новое взаимодействие"}},actions:{async getLvData(){t.modalLoad=!0;const e=await fetch(s.urls.klient+"/get",{method:"post",body:JSON.stringify(this.searchAndSort),headers:o.getHeader()});if(e.status===200){const a=await e.json();this.lvData=a.data,this.pageCount=a.pageCount,this.itemsCount=a.itemsCount}else t.showAlertError("Ошибка. Подробности в консоли или в логах");t.modalLoad=!1},async getDvData(e){t.modalLoad=!0,e===void 0&&(e=this.dvData.id);const a=await fetch(s.urls.klient+"/get",{method:"post",body:JSON.stringify({id:e}),headers:o.getHeader()});if(a.status===200){const i=await a.json();this.dvData=i.data}else t.showAlertError("Ошибка. Подробности в консоли или в логах");t.modalLoad=!1},async getDvKommunikacii(e){t.modalLoad=!0,e===void 0&&(e=this.dvKommunikacii.id);const a=await fetch(s.urls.klientKommunikacii+"/get",{method:"post",body:JSON.stringify({id:e}),headers:o.getHeader()});if(a.status===200){const i=await a.json();this.dvKommunikacii=i.data,this.getLvData(),this.getDvData()}else t.showAlertError("Ошибка. Подробности в консоли или в логах");t.modalLoad=!1},async saveBaseInfo(){let e="";if(this.dvData.id&&(e=prompt("Укажите примечание")),e!==null){if(!this.dvData.fio)return t.showAlertError("Укажите ФИО"),!1;t.modalLoad=!0,(await fetch(s.urls.klient+"/save",{method:"post",body:JSON.stringify({...this.dvData,note:e}),headers:o.getHeader()})).status===200?(this.getLvData(),this.getDvData(),this.showBaseModal=!1,t.showAlertInfo("Готово")):t.showAlertError("Ошибка. Подробности в консоли или в логах"),t.modalLoad=!1}},async saveAddressa(){const e=prompt("Укажите примечание (ВНИМАНИЕ строки без адреса не будут сохранены)");e!==null&&(t.modalLoad=!0,(await fetch(s.urls.klientAddress+"/save",{method:"post",body:JSON.stringify({addressa:this.dvData.addressa,klient:this.dvData.id,note:e}),headers:o.getHeader()})).status===200?(this.getLvData(),this.getDvData(),t.showAlertInfo("Готово")):t.showAlertError("Ошибка. Подробности в консоли или в логах"),t.modalLoad=!1)},async saveAlergii(){const e=prompt("Укажите примечание");e!==null&&(t.modalLoad=!0,(await fetch(s.urls.klientAlergia+"/save",{method:"post",body:JSON.stringify({alergii:this.dvData.alergii,klient:this.dvData.id,note:e}),headers:o.getHeader()})).status===200?(this.getLvData(),this.getDvData(),t.showAlertInfo("Готово")):t.showAlertError("Ошибка. Подробности в консоли или в логах"),t.modalLoad=!1)},async openBaseModal(e=null){e?await this.getDvData(e):this.dvData={addressa:[{}],alergii:[{}]},this.showBaseModal=!0},async openKommunikaciiModal(e=null){e?await this.getDvKommunikacii(e):this.dvKommunikacii={},this.showKommunikaciiModal=!0},async saveKommunikacii(){const e=prompt("Укажите примечание");e!==null&&(t.modalLoad=!0,(await fetch(s.urls.klientKommunikacii+"/save",{method:"post",body:JSON.stringify({message:this.dvData.message,klient:this.dvData.id,note:e}),headers:o.getHeader()})).status===200?(this.getLvData(),this.getDvData(),t.showAlertInfo("Готово")):t.showAlertError("Ошибка. Подробности в консоли или в логах"),this.showKommunikaciiModal=!1,t.modalLoad=!1)},reseatSearch(){this.searchAndSort={sortName:"id",sortOrder:"down",isArchive:!1},this.getLvData()},async updateSort(e){this.searchAndSort.sortName===e?this.searchAndSort.sortOrder==="up"?this.searchAndSort.sortOrder="down":(this.searchAndSort.sortName="id",this.searchAndSort.sortOrder="up"):(this.searchAndSort.sortName=e,this.searchAndSort.sortOrder="up"),this.getLvData()},async getAll(){this.searchAndSort.page=1,this.searchAndSort.showAll=!0,this.getLvData()},async delete(e){t.modalLoad=!0,(await fetch(s.urls.klient+"/delete",{method:"post",body:JSON.stringify({id:e}),headers:o.getHeader()})).status===200?(this.getLvData(),this.showBaseModal=!1,t.showAlertInfo("Готово")):t.showAlertError("Ошибка. Подробности в консоли или в логах"),t.modalLoad=!1},async getKlientListAll(){t.modalLoad=!0;const e=await fetch(s.urls.klient+"/get_all",{method:"post",body:JSON.stringify({showAll:!0,page:1}),headers:o.getHeader()});if(e.status===200){const a=await e.json();this.klientListAll=a.data}else t.showAlertError("Ошибка. Подробности в консоли или в логах");t.modalLoad=!1},async printCard(e){t.modalLoad=!0,e===void 0&&(e=this.dvData.id);const a=await fetch(s.urls.report+"/klient",{method:"post",body:JSON.stringify({id:e}),headers:o.getHeader()});a.status===200?open(a.url):t.showAlertError("Ошибка. Подробности в консоли или в логах"),t.modalLoad=!1}}});export{h as u};
